<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' https://accounts.google.com/gsi/client; style-src 'self' 'unsafe-inline'; img-src 'self' https://images.unsplash.com https://www.google.com data: blob:; connect-src 'self' https://api.rss2json.com https://api.open-meteo.com https://www.googleapis.com https://*.workers.dev; frame-src https://accounts.google.com/gsi/;">
  <title>My Start Page</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <!-- 上部固定バー -->
  <header class="top-bar">
    <div class="clock" id="clock"></div>

    <div class="search-bar">
      <form action="https://www.google.com/search" method="get" target="_blank">
        <input type="text" name="q" placeholder="Search...">
        <button type="submit">G</button>
      </form>
      <div id="quote-text" class="quote-under-search"><span class="skeleton" style="width:200px">Loading...</span></div>
    </div>

    <!-- 天気をクリックするとYahoo天気に飛ぶ -->
    <a href="https://weather.yahoo.co.jp/weather/" target="_blank" rel="noopener noreferrer" id="today-weather"
      class="weather-now">
      <span class="skeleton" style="width:150px">Loading...</span>
    </a>
    <button id="open-settings" style="background:none; border:none; font-size:1.2rem; margin-left:10px;">⚙️</button>
  </header>

  <!-- メイン -->
  <main class="main">

    <!-- 左カラム -->
    <div class="left-column">
      <section class="card">
        <div class="category-header-main">
          <div>
            <button id="toggle-category-form">＋ジャンル追加</button>
            <button id="toggle-edit">編集モード切替</button>
          </div>
          <div style="margin-left: auto;">
            <button id="export-data" title="設定を保存">💾</button>
            <button id="import-data" title="設定を復元">📂</button>
            <input type="file" id="import-file" style="display:none" accept=".json">
          </div>
        </div>

        <div id="category-form" style="display:none;" class="bookmark-form">
          <input type="text" id="category-name" placeholder="ジャンル名">
          <button id="save-category">保存</button>
          <button id="cancel-category" class="cancel">キャンセル</button>
        </div>

        <div id="category-list"></div>
      </section>

      <!-- ニュースフィード -->
      <section class="card news-card">
        <div class="section-header">
          <h2>📰 ニュース</h2>
          <a href="https://news.google.com/home?hl=ja&gl=JP&ceid=JP%3Aja" target="_blank" rel="noopener noreferrer"
            class="more-link">もっと見る →</a>
        </div>
        <div id="news-feed" class="news-feed">
          <div class="news-item skeleton-news">
            <span class="skeleton" style="width:100%; height:20px"></span>
          </div>
          <div class="news-item skeleton-news">
            <span class="skeleton" style="width:100%; height:20px"></span>
          </div>
          <div class="news-item skeleton-news">
            <span class="skeleton" style="width:100%; height:20px"></span>
          </div>
        </div>
      </section>
    </div>

    <!-- 右カラム -->
    <div class="right-column">

      <!-- カスタムカレンダー -->
      <section class="card calendar-section" aria-label="Calendar">
        <!-- ヘッダー：Googleログイン & ビュー切替 -->
        <div class="calendar-top-bar">
          <button id="google-login-btn" class="google-login-btn">
            <span class="login-icon">🔐</span>
            <span id="login-text">Googleでログイン</span>
          </button>
          <div class="view-toggle">
            <button id="view-month" class="view-btn active">月</button>
            <button id="view-week" class="view-btn">週</button>
          </div>
        </div>

        <!-- カレンダーナビゲーション -->
        <div class="calendar-nav">
          <button id="cal-prev" class="nav-btn">◀</button>
          <span id="cal-title" class="cal-title">2025年12月</span>
          <button id="cal-next" class="nav-btn">▶</button>
          <button id="cal-today" class="today-btn">今日</button>
        </div>

        <!-- 月ビュー -->
        <div id="month-view" class="calendar-view">
          <div class="weekday-header">
            <span class="weekday sun">日</span>
            <span class="weekday">月</span>
            <span class="weekday">火</span>
            <span class="weekday">水</span>
            <span class="weekday">木</span>
            <span class="weekday">金</span>
            <span class="weekday sat">土</span>
          </div>
          <div id="month-grid" class="month-grid"></div>
        </div>

        <!-- 週ビュー -->
        <div id="week-view" class="calendar-view" style="display:none;">
          <div id="week-grid" class="week-grid"></div>
        </div>

        <!-- 予定リスト -->
        <div id="agenda-section" class="agenda-section">
          <h3 class="agenda-title">📋 今後の予定</h3>
          <div id="agenda-list" class="agenda-list">
            <div class="agenda-empty">ログインして予定を表示</div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 設定モーダル -->
  <div id="settings-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>設定</h2>
        <span class="close-modal" id="close-settings">&times;</span>
      </div>

      <div class="setting-item">
        <label>背景画像URL</label>
        <input type="text" id="bg-url-input" placeholder="https://...">
      </div>

      <div class="setting-item">
        <label>天気予報 (緯度, 経度)</label>
        <div style="display:flex; gap:10px;">
          <input type="text" id="lat-input" placeholder="Latitude (例: 35.6895)">
          <input type="text" id="lon-input" placeholder="Longitude (例: 139.6917)">
        </div>
      </div>

      <div class="setting-item">
        <label>Google OAuth Client ID</label>
        <input type="text" id="client-id-input" placeholder="xxxxxxxxx.apps.googleusercontent.com">
        <small style="color:#888;">Google Cloud Console で取得</small>
      </div>

      <div class="setting-item">
        <label>OAuth Worker URL (Optional)</label>
        <input type="text" id="worker-url-input" placeholder="https://your-worker.workers.dev">
        <small style="color:#888;">自前のCloudflare Workerを使う場合のみ設定</small>
      </div>

      <div class="setting-item" id="calendar-logout-section" style="display:none;">
        <label>Googleカレンダー</label>
        <button id="calendar-logout-btn" class="delete-btn" style="display:inline-block;">ログアウト</button>
      </div>

      <div class="setting-item">
        <button id="save-settings" class="primary-btn">保存して閉じる</button>
      </div>
    </div>
  </div>

  <!-- 予定追加モーダル -->
  <div id="event-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>📅 予定を追加</h2>
        <span class="close-modal" id="close-event-modal">&times;</span>
      </div>

      <div class="setting-item">
        <label>タイトル</label>
        <input type="text" id="event-title" placeholder="予定のタイトル">
      </div>

      <div class="setting-item">
        <label>日付</label>
        <input type="date" id="event-date">
      </div>

      <div class="setting-item">
        <label>開始時刻 (任意)</label>
        <input type="time" id="event-start-time">
      </div>

      <div class="setting-item">
        <label>終了時刻 (任意)</label>
        <input type="time" id="event-end-time">
      </div>

      <div class="setting-item">
        <button id="save-event" class="primary-btn">予定を保存</button>
      </div>
    </div>
  </div>

  <!-- 分割されたJSファイル -->
  <script src="js/storage.js"></script><!-- IndexedDB永続ストレージ（最初に読み込み必須） -->
  <script src="js/clock.js"></script>
  <script src="js/weather.js"></script>
  <script src="js/news.js"></script>
  <script src="js/bookmarks.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/calendar.js"></script>
</body>

</html>